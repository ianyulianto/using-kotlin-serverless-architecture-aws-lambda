# Using Kotlin in a Serverless Architecture with AWS Lambda
Complete code per article for the complete series in medium https://medium.com/@juancho088/using-kotlin-in-a-serverless-architecture-with-aws-lambda-part-1-setting-up-the-project-87033790e2f4

# First Steps

1. Install nodeJS (download [link](https://nodejs.org/en/download/))
2. Run the command `npm install -g serverless`
3. Create your project running the command `serverless create —-template aws-kotlin-jvm-gradle --path your_service`
4. To configure your AWS credentials execute `serverless config credentials --provider aws --key EXAMPLE --secret EXAMPLEKEY`

# Package JSON

1. Create a package.json file with the minimum information so you can install serverless libraries.
```
{
  "name": "my-blockbuster",
  "version": "1.0.0"
}
```

# Plugins

## Serverless to SAM Local

You must have a functional Docker client on the system you plan to use SAM, so install that first if you don’t yet have it!

```
npm install --save-dev serverless-sam
```

Add the plugin in the serverless.yml file:

```
plugins:
  - serverless-sam
```

Compile your function using Shadow, that will generate a set of files in *build/libs/*:

````
gradle build shadowJar
````

Export and invoke your functions

```
sls sam export -o template.yml
sam local invoke hello <<< "{}"
```

*Note:* You will always need to run this command every single time you want to test your lambda function.
Also, by default the function names will start with capital letter.

To invoke custom event.json files you can execute the next command:

```
$ sam local invoke Hello -e src/main/resources/event.json
```

*Note:* Serverless to SAM-local plugin has an error with the memory and timeout values (in general with most
od the provider properties). To solve it, change the autogenerated template.yml to include the values
that you defined in your serverless.yml file.

````
MemorySize: 1024
Timeout: 10
````


chmod -R 777 /tmp/localstack


gradle zip

pip install awscli-local

pip unisntall awscli
pip install awscli --upgrade

https://stackoverflow.com/questions/48236040/exactly-which-path-do-i-curl-for-localstack-api-gateway-lambda-integration

awslocal apigateway get-rest-apis
awslocal apigateway get-rest-api --rest-api-id 896A-Z506179
awslocal apigateway get-resources --rest-api-id 896A-Z506179
awslocal apigateway get-deployments --rest-api-id 896A-Z506179

awslocal apigateway get-deployment --deployment-id 0749988816 --rest-api-id 896A-Z506179

awslocal apigateway get-integration --rest-api-id 896A-Z506179 --http-method GET --resource-id 92162A-Z85A-ZA-Z




awslocal lambda list-functions

docker pull localstack/localstack
docker pull localstack/localstack:latest
docker pull localstack/localstack:0.7.3
Also, the recommended way of starting LocalStack is using the CLI. Can you please try:

# NUNCA NONONONON
pip install --upgrade localstack



localstack start --docker


awslocal lambda invoke --function-name myblockbuster-local-hello --payload '{"resource":"/movies/{id}","path":"/movies","httpMethod":"GET","headers":{"Accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8","Accept-Encoding":"gzip, deflate, br","Accept-Language":"en-GB,en-US;q=0.8,en;q=0.6,zh-CN;q=0.4","cache-control":"max-age=0","CloudFront-Forwarded-Proto":"https","CloudFront-Is-Desktop-Viewer":"true","CloudFront-Is-Mobile-Viewer":"false","CloudFront-Is-SmartTV-Viewer":"false","CloudFront-Is-Tablet-Viewer":"false","CloudFront-Viewer-Country":"GB","content-type":"application/x-www-form-urlencoded","Host":"j3ap25j034.execute-api.eu-west-2.amazonaws.com","origin":"https://j3ap25j034.execute-api.eu-west-2.amazonaws.com","Referer":"https://j3ap25j034.execute-api.eu-west-2.amazonaws.com/dev/","upgrade-insecure-requests":"1","User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36","Via":"2.0 a3650115c5e21e2b5d133ce84464bea3.cloudfront.net (CloudFront)","X-Amz-Cf-Id":"0nDeiXnReyHYCkv8cc150MWCFCLFPbJoTs1mexDuKe2WJwK5ANgv2A==","X-Amzn-Trace-Id":"Root=1-597079de-75fec8453f6fd4812414a4cd","X-Forwarded-For":"50.129.117.14, 50.112.234.94","X-Forwarded-Port":"443","X-Forwarded-Proto":"https"},"queryStringParameters":null,"pathParameters":null,"stageVariables":null,"requestContext":{"path":"/dev/","accountId":"125002137610","resourceId":"qdolsr1yhk","stage":"dev","requestId":"0f2431a2-6d2f-11e7-b75152aa497861","identity":{"cognitoIdentityPoolId":null,"accountId":null,"cognitoIdentityId":null,"caller":null,"apiKey":"","sourceIp":"50.129.117.14","accessKey":null,"cognitoAuthenticationType":null,"cognitoAuthenticationProvider":null,"userArn":null,"userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36","user":null},"resourcePath":"/movies/{id}","httpMethod":"GET","apiId":"j3azlsj0c4"},"body":null,"isBase64Encoded":false}' outfile

awslocal lambda invoke --function-name myblockbuster-local-hello --payload file://src/test/resources/eventMovieGET.json outfile

awslocal lambda invoke --function-name myblockbuster-local-hello --payload file://src/test/resources/eventMovieGET.json --log-type tail --invocation-type RequestResponse outfile


2A-Z284A-Z0305
